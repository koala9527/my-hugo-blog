<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='前言 两年前买了四台树莓派4B 组了一个K8s 集群，在知乎，掘金发了两篇搭建的教程，一直都有人收藏，网上的教程也很少，今年年初看到树莓派溢价非常多，几乎没有做什么应用搭建在上面，就拿过来组集群写些教程使用了，所以索性咸鱼几乎翻倍都出了。 最近看到随身wifi棒子特别的火，又有人搭建利用随身wifi的Docker Swarm集群，自己有想动手弄一个，又在咸鱼淘了四个处理器为RK3568的机器，处理器配置比树莓派配置要好，但是只有4G内存，主要是才90元一个，买了12V DC电源。不到400。 如果对kubernetes基本概念不熟悉，请务必找到之前文章去熟悉一下，之前的文章的细节描述非常仔细清楚~ 系统是自带的Armbian: 1 2 root@panther-x2-main:~# uname -a Linux panther-x2-main 6.1.28-rockchip64 #1 SMP PREEMPT Thu May 11 14:04:52 UTC 2023 aarch64 aarch64 aarch64 GNU/Linux Armbian是轻量级的Debian系统，Linux有两大分支系列，一个是Debian 一个是Redhat。每个系列又有不同的更细的分支。 Redhat是商业公司维护的发行版本，Debian是社区组织维护的发行版本 一般个人折腾用Debian 社区强大，公司的生产环境用Centos。 开始 更改机器主机名称（hostname） 因为系统刷机后系统的名称完全一样，需要修改名称才能分辨他们 一台Master节点 ，3台Work节点， 需要把四台机器的分为改为： 1 2 3 4 panther-x2-main panther-x2-1 panther-x2-2 panther-x2-3 每台机器设置分别需要修改"/etc/hostname"文件内容 用Master节点举一个例子： 1 vim /etc/hostname 改完后的效果： 1 2 3 4 5 6 7 8 root@panther-x2-main:~# cat /etc/hostname panther-x2-main root@panther-x2-1:~# cat /etc/hostname panther-x2-1 root@panther-x2-2:~# cat /etc/hostname panther-x2-2 root@panther-x2-3:~# cat /etc/hostname panther-x2-3 设置静态IP 静态IP的作用就是让机器在内网环境下有一个固定的IP，不能让它每次重启有一个不一样的IP，那样机器之间就无法正常沟通了。'><title>用ARM盒子 再次搭建一个最新版本的K8s集群</title>
<link rel=canonical href=https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="用ARM盒子 再次搭建一个最新版本的K8s集群"><meta property='og:description' content='前言 两年前买了四台树莓派4B 组了一个K8s 集群，在知乎，掘金发了两篇搭建的教程，一直都有人收藏，网上的教程也很少，今年年初看到树莓派溢价非常多，几乎没有做什么应用搭建在上面，就拿过来组集群写些教程使用了，所以索性咸鱼几乎翻倍都出了。 最近看到随身wifi棒子特别的火，又有人搭建利用随身wifi的Docker Swarm集群，自己有想动手弄一个，又在咸鱼淘了四个处理器为RK3568的机器，处理器配置比树莓派配置要好，但是只有4G内存，主要是才90元一个，买了12V DC电源。不到400。 如果对kubernetes基本概念不熟悉，请务必找到之前文章去熟悉一下，之前的文章的细节描述非常仔细清楚~ 系统是自带的Armbian: 1 2 root@panther-x2-main:~# uname -a Linux panther-x2-main 6.1.28-rockchip64 #1 SMP PREEMPT Thu May 11 14:04:52 UTC 2023 aarch64 aarch64 aarch64 GNU/Linux Armbian是轻量级的Debian系统，Linux有两大分支系列，一个是Debian 一个是Redhat。每个系列又有不同的更细的分支。 Redhat是商业公司维护的发行版本，Debian是社区组织维护的发行版本 一般个人折腾用Debian 社区强大，公司的生产环境用Centos。 开始 更改机器主机名称（hostname） 因为系统刷机后系统的名称完全一样，需要修改名称才能分辨他们 一台Master节点 ，3台Work节点， 需要把四台机器的分为改为： 1 2 3 4 panther-x2-main panther-x2-1 panther-x2-2 panther-x2-3 每台机器设置分别需要修改"/etc/hostname"文件内容 用Master节点举一个例子： 1 vim /etc/hostname 改完后的效果： 1 2 3 4 5 6 7 8 root@panther-x2-main:~# cat /etc/hostname panther-x2-main root@panther-x2-1:~# cat /etc/hostname panther-x2-1 root@panther-x2-2:~# cat /etc/hostname panther-x2-2 root@panther-x2-3:~# cat /etc/hostname panther-x2-3 设置静态IP 静态IP的作用就是让机器在内网环境下有一个固定的IP，不能让它每次重启有一个不一样的IP，那样机器之间就无法正常沟通了。'><meta property='og:url' content='https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/'><meta property='og:site_name' content='Example Site'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='kubernetes'><meta property='article:published_time' content='2023-06-21T11:09:58+08:00'><meta property='article:modified_time' content='2023-06-21T11:09:58+08:00'><meta property='og:image' content='https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/1.27.png'><meta name=twitter:title content="用ARM盒子 再次搭建一个最新版本的K8s集群"><meta name=twitter:description content='前言 两年前买了四台树莓派4B 组了一个K8s 集群，在知乎，掘金发了两篇搭建的教程，一直都有人收藏，网上的教程也很少，今年年初看到树莓派溢价非常多，几乎没有做什么应用搭建在上面，就拿过来组集群写些教程使用了，所以索性咸鱼几乎翻倍都出了。 最近看到随身wifi棒子特别的火，又有人搭建利用随身wifi的Docker Swarm集群，自己有想动手弄一个，又在咸鱼淘了四个处理器为RK3568的机器，处理器配置比树莓派配置要好，但是只有4G内存，主要是才90元一个，买了12V DC电源。不到400。 如果对kubernetes基本概念不熟悉，请务必找到之前文章去熟悉一下，之前的文章的细节描述非常仔细清楚~ 系统是自带的Armbian: 1 2 root@panther-x2-main:~# uname -a Linux panther-x2-main 6.1.28-rockchip64 #1 SMP PREEMPT Thu May 11 14:04:52 UTC 2023 aarch64 aarch64 aarch64 GNU/Linux Armbian是轻量级的Debian系统，Linux有两大分支系列，一个是Debian 一个是Redhat。每个系列又有不同的更细的分支。 Redhat是商业公司维护的发行版本，Debian是社区组织维护的发行版本 一般个人折腾用Debian 社区强大，公司的生产环境用Centos。 开始 更改机器主机名称（hostname） 因为系统刷机后系统的名称完全一样，需要修改名称才能分辨他们 一台Master节点 ，3台Work节点， 需要把四台机器的分为改为： 1 2 3 4 panther-x2-main panther-x2-1 panther-x2-2 panther-x2-3 每台机器设置分别需要修改"/etc/hostname"文件内容 用Master节点举一个例子： 1 vim /etc/hostname 改完后的效果： 1 2 3 4 5 6 7 8 root@panther-x2-main:~# cat /etc/hostname panther-x2-main root@panther-x2-1:~# cat /etc/hostname panther-x2-1 root@panther-x2-2:~# cat /etc/hostname panther-x2-2 root@panther-x2-3:~# cat /etc/hostname panther-x2-3 设置静态IP 静态IP的作用就是让机器在内网环境下有一个固定的IP，不能让它每次重启有一个不一样的IP，那样机器之间就无法正常沟通了。'><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/1.27.png'><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hude7ef4174b9e080cf26a873c84ad564d_43441_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🍥</span></figure><div class=site-meta><h1 class=site-name><a href=/>Example Site</a></h1><h2 class=site-description>悟已往之不谏,知来者知可追</h2></div></header><ol class=menu-social><li><a href=https://github.com/koala9527 target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 640 640"><path d="M319.988 7.973C143.293 7.973.0 151.242.0 327.96c0 141.392 91.678 261.298 218.826 303.63 16.004 2.964 21.886-6.957 21.886-15.414.0-7.63-.319-32.835-.449-59.552-89.032 19.359-107.8-37.772-107.8-37.772-14.552-36.993-35.529-46.831-35.529-46.831-29.032-19.879 2.209-19.442 2.209-19.442 32.126 2.245 49.04 32.954 49.04 32.954 28.56 48.922 74.883 34.76 93.131 26.598 2.882-20.681 11.15-34.807 20.315-42.803-71.08-8.067-145.797-35.516-145.797-158.14.0-34.926 12.52-63.485 32.965-85.88-3.33-8.078-14.291-40.606 3.083-84.674.0.0 26.87-8.61 88.029 32.8 25.512-7.075 52.878-10.642 80.056-10.76 27.2.118 54.614 3.673 80.162 10.76 61.076-41.386 87.922-32.8 87.922-32.8 17.398 44.08 6.485 76.631 3.154 84.675 20.516 22.394 32.93 50.953 32.93 85.879.0 122.907-74.883 149.93-146.117 157.856 11.481 9.921 21.733 29.398 21.733 59.233.0 42.792-.366 77.28-.366 87.804.0 8.516 5.764 18.473 21.992 15.354 127.076-42.354 218.637-162.274 218.637-303.582.0-176.695-143.269-319.988-320-319.988l-.023.107z"/></svg></a></li><li><a href=https://juejin.cn/user/2893570335056494 target=_blank title=Juejin rel=me><svg width="36" height="28" viewBox="0 0 36 28" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M17.5875 6.77268l4.2357-3.36763L17.5875.00748237 17.5837.0 13.3555 3.39757l4.2282 3.37137L17.5875 6.77268zM17.5863 17.3955H17.59L28.5161 8.77432 25.5526 6.39453 17.59 12.6808H17.5863L17.5825 12.6845 9.61993 6.40201 6.66016 8.78181 17.5825 17.3992 17.5863 17.3955zM17.5828 23.2891 17.5865 23.2854 32.2133 11.7456l2.9635 2.3798-6.653 5.2498L17.5865 28 .284376 14.3574.0 14.1291l2.95977-2.376L17.5828 23.2891z" fill="#1e80ff"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#前言>前言</a></li><li><a href=#开始>开始</a><ol><li><a href=#更改机器主机名称hostname>更改机器主机名称（hostname）</a></li><li><a href=#设置静态ip>设置静态IP</a></li><li><a href=#关闭swap-内存交换空间>关闭swap 内存交换空间</a></li><li><a href=#关闭selinux>关闭SElinux</a></li><li><a href=#关闭ipv4转发>关闭IPv4转发</a></li><li><a href=#安装一些软件>安装一些软件</a></li><li><a href=#配置docker>配置docker</a></li><li><a href=#安装最新版kubeletkubeadmkubectl>安装最新版kubelet，kubeadm，kubectl</a></li><li><a href=#前置设置>前置设置</a></li><li><a href=#前置拉取镜像改名字>前置拉取镜像改名字：</a></li><li><a href=#开始安装>开始安装</a></li><li><a href=#安装pod-网络附加组件>安装Pod 网络附加组件</a></li><li><a href=#运到问题解决办法>运到问题解决办法</a></li><li><a href=#最后安装kubernetesdashboard>最后安装kubernetes/dashboard</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/><img src=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/1.27_hu5b229904d88bae7b6c258a13fba219d7_17319_800x0_resize_box_3.png srcset="/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/1.27_hu5b229904d88bae7b6c258a13fba219d7_17319_800x0_resize_box_3.png 800w, /p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/1.27_hu5b229904d88bae7b6c258a13fba219d7_17319_1600x0_resize_box_3.png 1600w" width=800 height=340 loading=lazy alt="Featured image of post 用ARM盒子 再次搭建一个最新版本的K8s集群"></a></div><div class=article-details><header class=article-category><a href=/categories/%E8%BF%90%E7%BB%B4/>运维</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/>用ARM盒子 再次搭建一个最新版本的K8s集群</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jun 21, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 8 分钟</time></div></footer></div></header><section class=article-content><h2 id=前言>前言</h2><p>两年前买了四台树莓派4B 组了一个K8s 集群，在知乎，掘金发了两篇搭建的教程，一直都有人收藏，网上的教程也很少，今年年初看到树莓派溢价非常多，几乎没有做什么应用搭建在上面，就拿过来组集群写些教程使用了，所以索性咸鱼几乎翻倍都出了。
最近看到随身wifi棒子特别的火，又有人搭建利用随身wifi的Docker Swarm集群，自己有想动手弄一个，又在咸鱼淘了四个处理器为RK3568的机器，处理器配置比树莓派配置要好，但是只有4G内存，主要是才90元一个，买了12V DC电源。不到400。
<img src=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img.png width=3472 height=3516 srcset="/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_hu15b83bf5d2d823155e26e27ae25ab1e4_13215049_480x0_resize_box_3.png 480w, /p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_hu15b83bf5d2d823155e26e27ae25ab1e4_13215049_1024x0_resize_box_3.png 1024w" loading=lazy alt=img.png class=gallery-image data-flex-grow=98 data-flex-basis=236px></p><p>如果对kubernetes基本概念不熟悉，请务必找到之前文章去熟悉一下，之前的文章的细节描述非常仔细清楚~</p><p>系统是自带的Armbian:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@panther-x2-main:~# uname -a
</span></span><span class=line><span class=cl>Linux panther-x2-main 6.1.28-rockchip64 <span class=c1>#1 SMP PREEMPT Thu May 11 14:04:52 UTC 2023 aarch64 aarch64 aarch64 GNU/Linux</span>
</span></span></code></pre></td></tr></table></div></div><p>Armbian是轻量级的Debian系统，Linux有两大分支系列，一个是Debian 一个是Redhat。每个系列又有不同的更细的分支。
Redhat是商业公司维护的发行版本，Debian是社区组织维护的发行版本
一般个人折腾用Debian 社区强大，公司的生产环境用Centos。</p><p><img src=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_1.png width=952 height=449 srcset="/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_1_hu53626e8b15ccdf75e1652654ccb860fd_24907_480x0_resize_box_3.png 480w, /p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_1_hu53626e8b15ccdf75e1652654ccb860fd_24907_1024x0_resize_box_3.png 1024w" loading=lazy alt=img_1.png class=gallery-image data-flex-grow=212 data-flex-basis=508px></p><h2 id=开始>开始</h2><h3 id=更改机器主机名称hostname>更改机器主机名称（hostname）</h3><p>因为系统刷机后系统的名称完全一样，需要修改名称才能分辨他们</p><p>一台Master节点 ，3台Work节点， 需要把四台机器的分为改为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>panther-x2-main
</span></span><span class=line><span class=cl>panther-x2-1
</span></span><span class=line><span class=cl>panther-x2-2
</span></span><span class=line><span class=cl>panther-x2-3
</span></span></code></pre></td></tr></table></div></div><p>每台机器设置分别需要修改"/etc/hostname"文件内容
用Master节点举一个例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vim /etc/hostname
</span></span></code></pre></td></tr></table></div></div><p>改完后的效果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@panther-x2-main:~# cat /etc/hostname
</span></span><span class=line><span class=cl>panther-x2-main
</span></span><span class=line><span class=cl>root@panther-x2-1:~# cat /etc/hostname
</span></span><span class=line><span class=cl>panther-x2-1
</span></span><span class=line><span class=cl>root@panther-x2-2:~# cat /etc/hostname
</span></span><span class=line><span class=cl>panther-x2-2
</span></span><span class=line><span class=cl>root@panther-x2-3:~# cat /etc/hostname
</span></span><span class=line><span class=cl>panther-x2-3
</span></span></code></pre></td></tr></table></div></div><h3 id=设置静态ip>设置静态IP</h3><p>静态IP的作用就是让机器在内网环境下有一个固定的IP，不能让它每次重启有一个不一样的IP，那样机器之间就无法正常沟通了。</p><p><img src=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_2.png width=1882 height=829 srcset="/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_2_hue4ba305397627b2d8139ddc94f49390e_93976_480x0_resize_box_3.png 480w, /p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_2_hue4ba305397627b2d8139ddc94f49390e_93976_1024x0_resize_box_3.png 1024w" loading=lazy alt=img_2.png class=gallery-image data-flex-grow=227 data-flex-basis=544px>
每一台机器都需要执行一样的命令：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo cat &gt;&gt; /etc/hosts <span class=s>&lt;&lt; EOF
</span></span></span><span class=line><span class=cl><span class=s>192.168.2.191 panther-x2-main
</span></span></span><span class=line><span class=cl><span class=s>192.168.2.192 panther-x2-1
</span></span></span><span class=line><span class=cl><span class=s>192.168.2.193 panther-x2-2
</span></span></span><span class=line><span class=cl><span class=s>192.168.2.194 panther-x2-3
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=关闭swap-内存交换空间>关闭swap 内存交换空间</h3><p>关闭它是为了保证Kubernetes集群的稳定性和可靠性，Swap分区是一种虚拟内存技术，当系统内存不足时，会将少用的内存数据交换到硬盘中，以便释放更多的内存空间给正在运行的进程使用。但是，当Swap分区被使用时，它会导致系统的性能下降，因为硬盘速度比内存慢得多。如果Kubernetes节点上的应用程序频繁地使用Swap分区，那么整个集群的性能就会受到影响，因此关闭Swap分区可以避免这种情况的发生</p><p>每台机器都要执行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vim  /etc/default/armbian-zram-config 
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_5.png width=522 height=175 srcset="/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_5_hu84c1a17fb53b98945a9bd308465d92bc_10669_480x0_resize_box_3.png 480w, /p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_5_hu84c1a17fb53b98945a9bd308465d92bc_10669_1024x0_resize_box_3.png 1024w" loading=lazy alt=img_5.png class=gallery-image data-flex-grow=298 data-flex-basis=715px></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vim /etc/cron.d/armbian-truncate-logs
</span></span></code></pre></td></tr></table></div></div><p>注释掉第三行</p><p><img src=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_4.png width=507 height=70 srcset="/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_4_huba29910d048b080eb63bdcfbd5e4863e_3618_480x0_resize_box_3.png 480w, /p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_4_huba29910d048b080eb63bdcfbd5e4863e_3618_1024x0_resize_box_3.png 1024w" loading=lazy alt=img_4.png class=gallery-image data-flex-grow=724 data-flex-basis=1738px></p><p>然后注释掉最后一行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vim /etc/cron.daily/armbian-ram-logging
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_3.png width=487 height=111 srcset="/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_3_hud96b3ec071a7b82bab1addd9577eb6d7_4555_480x0_resize_box_3.png 480w, /p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_3_hud96b3ec071a7b82bab1addd9577eb6d7_4555_1024x0_resize_box_3.png 1024w" loading=lazy alt=img_3.png class=gallery-image data-flex-grow=438 data-flex-basis=1052px></p><p>然后重启，验证swap是否被关闭：</p><p><img src=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_6.png width=971 height=123 srcset="/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_6_hu2cbadfc9317087234066e39692b3f048_7718_480x0_resize_box_3.png 480w, /p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_6_hu2cbadfc9317087234066e39692b3f048_7718_1024x0_resize_box_3.png 1024w" loading=lazy alt=img_6.png class=gallery-image data-flex-grow=789 data-flex-basis=1894px></p><h3 id=关闭selinux>关闭SElinux</h3><p>根据提示没有安装</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@panther-x2-main:~# dpkg -s selinux-policy-default
</span></span><span class=line><span class=cl>dpkg-query: package <span class=s1>&#39;selinux-policy-default&#39;</span> is not installed and no information is available
</span></span><span class=line><span class=cl>Use dpkg --info <span class=o>(=</span> dpkg-deb --info<span class=o>)</span> to examine archive files.
</span></span></code></pre></td></tr></table></div></div><h3 id=关闭ipv4转发>关闭IPv4转发</h3><p>IPv4 转发通常允许将网络流量从一个网络接口传输到另一个网络接口可能会导致安全漏洞。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>/etc/sysctl.conf
</span></span></code></pre></td></tr></table></div></div><p>默认关闭了：</p><p><img src=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_7.png width=499 height=573 srcset="/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_7_hudb578ee901340abb3e9cdcd1c3a6f199_23762_480x0_resize_box_3.png 480w, /p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_7_hudb578ee901340abb3e9cdcd1c3a6f199_23762_1024x0_resize_box_3.png 1024w" loading=lazy alt=img_7.png class=gallery-image data-flex-grow=87 data-flex-basis=209px></p><h3 id=安装一些软件>安装一些软件</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>apt-get update
</span></span><span class=line><span class=cl>apt-get install apt-transport-https <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>ca-certificates <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>curl <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>gnupg2  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>software-properties-common
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo apt-get install docker-ce docker-ce-cli containerd.io
</span></span></code></pre></td></tr></table></div></div><h3 id=配置docker>配置docker</h3><p>这个非常重要，Kubernetes官方指出在1.24之后删除了dockershim组件，我现在在要安装最新版的kubernetes1.27,默认的运行时是contained，而目前Docker 安装的默认运行时是docker-runc，所以需要切换Docker 的运行时。
偷了懒问了一下chatgpt 如何切换docker运行时，实测很准确</p><p><img src=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_8.png width=1246 height=776 srcset="/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_8_huef751047c201086cddd84af8e5993455_22763_480x0_resize_box_3.png 480w, /p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_8_huef751047c201086cddd84af8e5993455_22763_1024x0_resize_box_3.png 1024w" loading=lazy alt=img_8.png class=gallery-image data-flex-grow=160 data-flex-basis=385px></p><p>最近因为某些原因Docker好多镜像拉取不下来，需要手动添加一下镜像源，需要如下修改：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@panther-x2-main:~# cat /etc/docker/daemon.json 
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;exec-opts&#34;</span>: <span class=o>[</span><span class=s2>&#34;native.cgroupdriver=systemd&#34;</span><span class=o>]</span>,
</span></span><span class=line><span class=cl> <span class=s2>&#34;registry-mirrors&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>         <span class=s2>&#34;https://docker.m.daocloud.io&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;https://dockerproxy.com&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;https://docker.mirrors.ustc.edu.cn&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;https://docker.nju.edu.cn&#34;</span>
</span></span><span class=line><span class=cl> <span class=o>]</span>,
</span></span><span class=line><span class=cl> <span class=s2>&#34;default-runtime&#34;</span>: <span class=s2>&#34;containerd&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;runtimes&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;containerd&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;path&#34;</span>: <span class=s2>&#34;/usr/bin/containerd&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>最后验证一下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@panther-x2-main:~# docker info <span class=p>|</span> grep -i runtime
</span></span><span class=line><span class=cl> Runtimes: containerd io.containerd.runc.v2 runc
</span></span><span class=line><span class=cl> Default Runtime: containerd
</span></span><span class=line><span class=cl>root@panther-x2-main:~# 
</span></span></code></pre></td></tr></table></div></div><h3 id=安装最新版kubeletkubeadmkubectl>安装最新版kubelet，kubeadm，kubectl</h3><p>每个机器都有需要执行以下命令：
更新 apt 包索引并安装使用 Kubernetes apt 仓库所需要的包：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo apt-get update
</span></span><span class=line><span class=cl>sudo apt-get install -y apt-transport-https ca-certificates curl
</span></span></code></pre></td></tr></table></div></div><p>下载 Google Cloud 公开签名秘钥：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl -fsSL https://packages.cloud.google.com/apt/doc/apt-key.gpg <span class=p>|</span> sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-archive-keyring.gpg
</span></span></code></pre></td></tr></table></div></div><p>添加 Kubernetes apt 仓库：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;deb [signed-by=/etc/apt/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main&#34;</span> <span class=p>|</span> sudo tee /etc/apt/sources.list.d/kubernetes.list
</span></span></code></pre></td></tr></table></div></div><p>安装 kubelet、kubeadm 和 kubectl，之前使用树莓派安装的是1.20版本的，社区已经不支持和维护了，k8s版本迭代的还是很快的，目前是四个月一个小版本，一个月支持版本一个补丁，还是很快的，有很大的学习压力呀，还有关联到了各种的组件的支持
目前最新的版本是1.27，现在来根据官方文档安装：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo apt-get install -y kubelet kubeadm kubectl
</span></span><span class=line><span class=cl>sudo apt-mark hold kubelet kubeadm kubectl
</span></span></code></pre></td></tr></table></div></div><h3 id=前置设置>前置设置</h3><p>根据文档/etc/containerd/config.toml 更改驱动<br>containerd config default > /etc/containerd/config.toml</p><p><img src=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_10.png width=1016 height=567 srcset="/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_10_hu3a0e544ebd55b83f9c948107e9a3cfac_40152_480x0_resize_box_3.png 480w, /p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_10_hu3a0e544ebd55b83f9c948107e9a3cfac_40152_1024x0_resize_box_3.png 1024w" loading=lazy alt=img_10.png class=gallery-image data-flex-grow=179 data-flex-basis=430px></p><p>修改：/etc/containerd/config.toml</p><p>将SystemdCgroup的值修改为true，将sandbox_image的值修改为国内镜像registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.8
<img src=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_9.png width=1081 height=804 srcset="/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_9_hued8834697a64558b236a99fbe9faa5e5_51294_480x0_resize_box_3.png 480w, /p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_9_hued8834697a64558b236a99fbe9faa5e5_51294_1024x0_resize_box_3.png 1024w" loading=lazy alt=img_9.png class=gallery-image data-flex-grow=134 data-flex-basis=322px></p><p>然后重启contained:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>systemctl restart containerd
</span></span></code></pre></td></tr></table></div></div><p>还可以做一下前置检查</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubeadm init phase preflight
</span></span></code></pre></td></tr></table></div></div><h3 id=前置拉取镜像改名字>前置拉取镜像改名字：</h3><p>由于某些原因直接拉去k8s所需要的镜像是拉取不下来的，只能参照官方的离线安装方案，先把同步到国内源的镜像拉取下来再改tag名称，最好做一个shell脚本，每台机器都需要执行一下拉取镜像，改tag名称：
脚本内容：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@panther-x2-main:~# cat pull_k8s_docker.sh 
</span></span><span class=line><span class=cl><span class=nv>MY_REGISTRY</span><span class=o>=</span>registry.aliyuncs.com/google_containers
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>K8S_VERSION</span><span class=o>=</span><span class=s2>&#34;v1.27.2&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;==========================================================&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Pull Kubernetes for x64 v</span><span class=nv>$K8S_VERSION</span><span class=s2> Images from docker.io ......&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;==========================================================&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>## 拉取镜像%s/oldWords/newWords//g</span>
</span></span><span class=line><span class=cl>docker pull <span class=si>${</span><span class=nv>MY_REGISTRY</span><span class=si>}</span>/kube-apiserver:<span class=nv>$K8S_VERSION</span>
</span></span><span class=line><span class=cl>docker pull <span class=si>${</span><span class=nv>MY_REGISTRY</span><span class=si>}</span>/kube-controller-manager:<span class=nv>$K8S_VERSION</span>
</span></span><span class=line><span class=cl>docker pull <span class=si>${</span><span class=nv>MY_REGISTRY</span><span class=si>}</span>/kube-scheduler:<span class=nv>$K8S_VERSION</span>
</span></span><span class=line><span class=cl>docker pull <span class=si>${</span><span class=nv>MY_REGISTRY</span><span class=si>}</span>/kube-proxy:<span class=nv>$K8S_VERSION</span>
</span></span><span class=line><span class=cl>docker pull <span class=si>${</span><span class=nv>MY_REGISTRY</span><span class=si>}</span>/pause:3.8
</span></span><span class=line><span class=cl>docker pull <span class=si>${</span><span class=nv>MY_REGISTRY</span><span class=si>}</span>/etcd:3.5.7-0
</span></span><span class=line><span class=cl>docker pull coredns/coredns:1.10.1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 添加Tag</span>
</span></span><span class=line><span class=cl>docker tag <span class=si>${</span><span class=nv>MY_REGISTRY</span><span class=si>}</span>/kube-apiserver:<span class=nv>$K8S_VERSION</span> registry.k8s.io/kube-apiserver:<span class=nv>$K8S_VERSION</span>
</span></span><span class=line><span class=cl>docker tag <span class=si>${</span><span class=nv>MY_REGISTRY</span><span class=si>}</span>/kube-scheduler:<span class=nv>$K8S_VERSION</span> registry.k8s.io/kube-scheduler:<span class=nv>$K8S_VERSION</span>
</span></span><span class=line><span class=cl>docker tag <span class=si>${</span><span class=nv>MY_REGISTRY</span><span class=si>}</span>/kube-controller-manager:<span class=nv>$K8S_VERSION</span> registry.k8s.io/kube-controller-manager:<span class=nv>$K8S_VERSION</span>
</span></span><span class=line><span class=cl>docker tag <span class=si>${</span><span class=nv>MY_REGISTRY</span><span class=si>}</span>/kube-proxy:<span class=nv>$K8S_VERSION</span> registry.k8s.io/kube-proxy:<span class=nv>$K8S_VERSION</span>
</span></span><span class=line><span class=cl>docker tag <span class=si>${</span><span class=nv>MY_REGISTRY</span><span class=si>}</span>/pause:3.8 registry.k8s.io/pause:3.8
</span></span><span class=line><span class=cl>docker tag <span class=si>${</span><span class=nv>MY_REGISTRY</span><span class=si>}</span>/etcd:3.5.7-0 registry.k8s.io/etcd:3.5.7-0
</span></span><span class=line><span class=cl>docker tag coredns/coredns:1.10.1 registry.k8s.io/coredns:v1.10.1
</span></span></code></pre></td></tr></table></div></div><h3 id=开始安装>开始安装</h3><p>在Master 节点执行一下命令：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo kubeadm init --image-repository<span class=o>=</span>registry.aliyuncs.com/google_containers --kubernetes-version<span class=o>=</span>v1.27.2 --apiserver-advertise-address<span class=o>=</span>192.168.2.191 --pod-network-cidr<span class=o>=</span>192.168.0.0/16 --ignore-preflight-errors<span class=o>=</span>all
</span></span></code></pre></td></tr></table></div></div><p>效果如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@panther-x2-main:~# sudo kubeadm init --image-repository<span class=o>=</span>registry.aliyuncs.com/google_containers --kubernetes-version<span class=o>=</span>v1.27.2 --apiserver-advertise-address<span class=o>=</span>192.168.2.191 --pod-network-cidr<span class=o>=</span>192.168.0.0/16 --ignore-preflight-errors<span class=o>=</span>all
</span></span><span class=line><span class=cl><span class=o>[</span>init<span class=o>]</span> Using Kubernetes version: v1.27.2
</span></span><span class=line><span class=cl><span class=o>[</span>preflight<span class=o>]</span> Running pre-flight checks
</span></span><span class=line><span class=cl><span class=o>[</span>preflight<span class=o>]</span> Pulling images required <span class=k>for</span> setting up a Kubernetes cluster
</span></span><span class=line><span class=cl><span class=o>[</span>preflight<span class=o>]</span> This might take a minute or two, depending on the speed of your internet connection
</span></span><span class=line><span class=cl><span class=o>[</span>preflight<span class=o>]</span> You can also perform this action in beforehand using <span class=s1>&#39;kubeadm config images pull&#39;</span>
</span></span><span class=line><span class=cl>W0611 22:16:04.216900    <span class=m>4263</span> images.go:80<span class=o>]</span> could not find officially supported version of etcd <span class=k>for</span> Kubernetes v1.27.2, falling back to the nearest etcd version <span class=o>(</span>3.5.7-0<span class=o>)</span>
</span></span><span class=line><span class=cl>W0611 22:16:04.743772    <span class=m>4263</span> checks.go:835<span class=o>]</span> detected that the sandbox image <span class=s2>&#34;registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.8&#34;</span> of the container runtime is inconsistent with that used by kubeadm. It is recommended that using <span class=s2>&#34;registry.aliyuncs.com/google_containers/pause:3.9&#34;</span> as the CRI sandbox image.
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Using certificateDir folder <span class=s2>&#34;/etc/kubernetes/pki&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;ca&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;apiserver&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> apiserver serving cert is signed <span class=k>for</span> DNS names <span class=o>[</span>kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local panther-x2-main<span class=o>]</span> and IPs <span class=o>[</span>10.96.0.1 192.168.2.191<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;apiserver-kubelet-client&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;front-proxy-ca&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;front-proxy-client&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;etcd/ca&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;etcd/server&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> etcd/server serving cert is signed <span class=k>for</span> DNS names <span class=o>[</span>localhost panther-x2-main<span class=o>]</span> and IPs <span class=o>[</span>192.168.2.191 127.0.0.1 ::1<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;etcd/peer&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> etcd/peer serving cert is signed <span class=k>for</span> DNS names <span class=o>[</span>localhost panther-x2-main<span class=o>]</span> and IPs <span class=o>[</span>192.168.2.191 127.0.0.1 ::1<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;etcd/healthcheck-client&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;apiserver-etcd-client&#34;</span> certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>certs<span class=o>]</span> Generating <span class=s2>&#34;sa&#34;</span> key and public key
</span></span><span class=line><span class=cl><span class=o>[</span>kubeconfig<span class=o>]</span> Using kubeconfig folder <span class=s2>&#34;/etc/kubernetes&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>kubeconfig<span class=o>]</span> Writing <span class=s2>&#34;admin.conf&#34;</span> kubeconfig file
</span></span><span class=line><span class=cl><span class=o>[</span>kubeconfig<span class=o>]</span> Writing <span class=s2>&#34;kubelet.conf&#34;</span> kubeconfig file
</span></span><span class=line><span class=cl><span class=o>[</span>kubeconfig<span class=o>]</span> Writing <span class=s2>&#34;controller-manager.conf&#34;</span> kubeconfig file
</span></span><span class=line><span class=cl><span class=o>[</span>kubeconfig<span class=o>]</span> Writing <span class=s2>&#34;scheduler.conf&#34;</span> kubeconfig file
</span></span><span class=line><span class=cl><span class=o>[</span>kubelet-start<span class=o>]</span> Writing kubelet environment file with flags to file <span class=s2>&#34;/var/lib/kubelet/kubeadm-flags.env&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>kubelet-start<span class=o>]</span> Writing kubelet configuration to file <span class=s2>&#34;/var/lib/kubelet/config.yaml&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>kubelet-start<span class=o>]</span> Starting the kubelet
</span></span><span class=line><span class=cl><span class=o>[</span>control-plane<span class=o>]</span> Using manifest folder <span class=s2>&#34;/etc/kubernetes/manifests&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>control-plane<span class=o>]</span> Creating static Pod manifest <span class=k>for</span> <span class=s2>&#34;kube-apiserver&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>control-plane<span class=o>]</span> Creating static Pod manifest <span class=k>for</span> <span class=s2>&#34;kube-controller-manager&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>control-plane<span class=o>]</span> Creating static Pod manifest <span class=k>for</span> <span class=s2>&#34;kube-scheduler&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>etcd<span class=o>]</span> Creating static Pod manifest <span class=k>for</span> <span class=nb>local</span> etcd in <span class=s2>&#34;/etc/kubernetes/manifests&#34;</span>
</span></span><span class=line><span class=cl>W0611 22:16:26.878081    <span class=m>4263</span> images.go:80<span class=o>]</span> could not find officially supported version of etcd <span class=k>for</span> Kubernetes v1.27.2, falling back to the nearest etcd version <span class=o>(</span>3.5.7-0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>wait-control-plane<span class=o>]</span> Waiting <span class=k>for</span> the kubelet to boot up the control plane as static Pods from directory <span class=s2>&#34;/etc/kubernetes/manifests&#34;</span>. This can take up to 4m0s
</span></span><span class=line><span class=cl><span class=o>[</span>apiclient<span class=o>]</span> All control plane components are healthy after 21.008446 seconds
</span></span><span class=line><span class=cl><span class=o>[</span>upload-config<span class=o>]</span> Storing the configuration used in ConfigMap <span class=s2>&#34;kubeadm-config&#34;</span> in the <span class=s2>&#34;kube-system&#34;</span> Namespace
</span></span><span class=line><span class=cl><span class=o>[</span>kubelet<span class=o>]</span> Creating a ConfigMap <span class=s2>&#34;kubelet-config&#34;</span> in namespace kube-system with the configuration <span class=k>for</span> the kubelets in the cluster
</span></span><span class=line><span class=cl><span class=o>[</span>upload-certs<span class=o>]</span> Skipping phase. Please see --upload-certs
</span></span><span class=line><span class=cl><span class=o>[</span>mark-control-plane<span class=o>]</span> Marking the node panther-x2-main as control-plane by adding the labels: <span class=o>[</span>node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>mark-control-plane<span class=o>]</span> Marking the node panther-x2-main as control-plane by adding the taints <span class=o>[</span>node-role.kubernetes.io/control-plane:NoSchedule<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>bootstrap-token<span class=o>]</span> Using token: fnxxr7.lgu8fvkl1rc0gukc
</span></span><span class=line><span class=cl><span class=o>[</span>bootstrap-token<span class=o>]</span> Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
</span></span><span class=line><span class=cl><span class=o>[</span>bootstrap-token<span class=o>]</span> Configured RBAC rules to allow Node Bootstrap tokens to get nodes
</span></span><span class=line><span class=cl><span class=o>[</span>bootstrap-token<span class=o>]</span> Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order <span class=k>for</span> nodes to get long term certificate credentials
</span></span><span class=line><span class=cl><span class=o>[</span>bootstrap-token<span class=o>]</span> Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
</span></span><span class=line><span class=cl><span class=o>[</span>bootstrap-token<span class=o>]</span> Configured RBAC rules to allow certificate rotation <span class=k>for</span> all node client certificates in the cluster
</span></span><span class=line><span class=cl><span class=o>[</span>bootstrap-token<span class=o>]</span> Creating the <span class=s2>&#34;cluster-info&#34;</span> ConfigMap in the <span class=s2>&#34;kube-public&#34;</span> namespace
</span></span><span class=line><span class=cl><span class=o>[</span>kubelet-finalize<span class=o>]</span> Updating <span class=s2>&#34;/etc/kubernetes/kubelet.conf&#34;</span> to point to a rotatable kubelet client certificate and key
</span></span><span class=line><span class=cl><span class=o>[</span>addons<span class=o>]</span> Applied essential addon: CoreDNS
</span></span><span class=line><span class=cl><span class=o>[</span>addons<span class=o>]</span> Applied essential addon: kube-proxy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Your Kubernetes control-plane has initialized successfully!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>To start using your cluster, you need to run the following as a regular user:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  mkdir -p <span class=nv>$HOME</span>/.kube
</span></span><span class=line><span class=cl>  sudo cp -i /etc/kubernetes/admin.conf <span class=nv>$HOME</span>/.kube/config
</span></span><span class=line><span class=cl>  sudo chown <span class=k>$(</span>id -u<span class=k>)</span>:<span class=k>$(</span>id -g<span class=k>)</span> <span class=nv>$HOME</span>/.kube/config
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Alternatively, <span class=k>if</span> you are the root user, you can run:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>export</span> <span class=nv>KUBECONFIG</span><span class=o>=</span>/etc/kubernetes/admin.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>You should now deploy a pod network to the cluster.
</span></span><span class=line><span class=cl>Run <span class=s2>&#34;kubectl apply -f [podnetwork].yaml&#34;</span> with one of the options listed at:
</span></span><span class=line><span class=cl>  https://kubernetes.io/docs/concepts/cluster-administration/addons/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Then you can join any number of worker nodes by running the following on each as root:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubeadm join 192.168.2.191:6443 --token fnxxr7.lgu8fvkl1******* <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--discovery-token-ca-cert-hash sha256:17a1ad0ad3da3cd3d558c7ba9029cd0043c5a4fa53c2********************* 
</span></span></code></pre></td></tr></table></div></div><p>安装成功。已经提示需要再在Work节点使用 <code>kubeadm join</code> 就行了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubeadm join 192.168.2.191:6443 --token fnxxr7.lgu8fvkl1******* <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	--discovery-token-ca-cert-hash sha256:17a1ad0ad3da3cd3d558c7ba9029cd0043c5a4fa53c2********************* 
</span></span></code></pre></td></tr></table></div></div><h3 id=安装pod-网络附加组件>安装Pod 网络附加组件</h3><p>查看node 状态执行之前需要根据上面的提示让当前用户有管理k8s的权限：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>  mkdir -p <span class=nv>$HOME</span>/.kube
</span></span><span class=line><span class=cl>  sudo cp -i /etc/kubernetes/admin.conf <span class=nv>$HOME</span>/.kube/config
</span></span><span class=line><span class=cl>  sudo chown <span class=k>$(</span>id -u<span class=k>)</span>:<span class=k>$(</span>id -g<span class=k>)</span> <span class=nv>$HOME</span>/.kube/config
</span></span></code></pre></td></tr></table></div></div><p>然后使用<code>kubectl get nodes</code> 查看每个node的状态，目前是notready的状态，需要安装网络覆盖组件</p><p>首先，在您的集群上安装 Operator</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.26.0/manifests/tigera-operator.yaml
</span></span></code></pre></td></tr></table></div></div><p>下载配置 Calico 所需的自定义资源</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl https://raw.githubusercontent.com/projectcalico/calico/v3.26.0/manifests/custom-resources.yaml -O
</span></span></code></pre></td></tr></table></div></div><p>创建清单以安装 Calico</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl create -f custom-resources.yaml
</span></span></code></pre></td></tr></table></div></div><p>稍等一会查看所有pod状态</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@panther-x2-main:~# kubectl get pod -A
</span></span><span class=line><span class=cl>NAMESPACE          NAME                                       READY   STATUS    RESTARTS      AGE
</span></span><span class=line><span class=cl>calico-apiserver   calico-apiserver-76fd8c9559-nfd8b          1/1     Running   <span class=m>0</span>             3m6s
</span></span><span class=line><span class=cl>calico-apiserver   calico-apiserver-76fd8c9559-zbwrq          1/1     Running   <span class=m>0</span>             3m6s
</span></span><span class=line><span class=cl>calico-system      calico-kube-controllers-6bcdfc4b44-mlp8w   1/1     Running   <span class=m>0</span>             15m
</span></span><span class=line><span class=cl>calico-system      calico-node-7gv5s                          1/1     Running   <span class=m>0</span>             15m
</span></span><span class=line><span class=cl>calico-system      calico-node-ck8vf                          1/1     Running   <span class=m>0</span>             15m
</span></span><span class=line><span class=cl>calico-system      calico-node-scd9k                          1/1     Running   <span class=m>0</span>             15m
</span></span><span class=line><span class=cl>calico-system      calico-node-vzwr9                          1/1     Running   <span class=m>0</span>             15m
</span></span><span class=line><span class=cl>calico-system      calico-typha-5fd468897-gw7gd               1/1     Running   <span class=m>0</span>             15m
</span></span><span class=line><span class=cl>calico-system      calico-typha-5fd468897-n2qkq               1/1     Running   <span class=m>0</span>             15m
</span></span><span class=line><span class=cl>calico-system      csi-node-driver-9ph8d                      2/2     Running   <span class=m>0</span>             15m
</span></span><span class=line><span class=cl>calico-system      csi-node-driver-kj26d                      2/2     Running   <span class=m>0</span>             15m
</span></span><span class=line><span class=cl>calico-system      csi-node-driver-m6945                      2/2     Running   <span class=m>0</span>             15m
</span></span><span class=line><span class=cl>calico-system      csi-node-driver-sjxps                      2/2     Running   <span class=m>0</span>             15m
</span></span><span class=line><span class=cl>kube-system        coredns-7bdc4cb885-5krtc                   1/1     Running   <span class=m>7</span> <span class=o>(</span>99m ago<span class=o>)</span>   47h
</span></span><span class=line><span class=cl>kube-system        coredns-7bdc4cb885-pbxc4                   1/1     Running   <span class=m>7</span> <span class=o>(</span>99m ago<span class=o>)</span>   47h
</span></span><span class=line><span class=cl>kube-system        etcd-panther-x2-main                       1/1     Running   <span class=m>9</span> <span class=o>(</span>99m ago<span class=o>)</span>   47h
</span></span><span class=line><span class=cl>kube-system        kube-apiserver-panther-x2-main             1/1     Running   <span class=m>9</span> <span class=o>(</span>99m ago<span class=o>)</span>   47h
</span></span><span class=line><span class=cl>kube-system        kube-controller-manager-panther-x2-main    1/1     Running   <span class=m>6</span> <span class=o>(</span>99m ago<span class=o>)</span>   10h
</span></span><span class=line><span class=cl>kube-system        kube-proxy-8jgfs                           1/1     Running   <span class=m>5</span> <span class=o>(</span>99m ago<span class=o>)</span>   47h
</span></span><span class=line><span class=cl>kube-system        kube-proxy-9g4vg                           1/1     Running   <span class=m>5</span> <span class=o>(</span>99m ago<span class=o>)</span>   47h
</span></span><span class=line><span class=cl>kube-system        kube-proxy-qc84s                           1/1     Running   <span class=m>5</span> <span class=o>(</span>99m ago<span class=o>)</span>   47h
</span></span><span class=line><span class=cl>kube-system        kube-proxy-zwbqm                           1/1     Running   <span class=m>9</span> <span class=o>(</span>99m ago<span class=o>)</span>   47h
</span></span><span class=line><span class=cl>kube-system        kube-scheduler-panther-x2-main             1/1     Running   <span class=m>9</span> <span class=o>(</span>99m ago<span class=o>)</span>   47h
</span></span><span class=line><span class=cl>tigera-operator    tigera-operator-58f95869d6-9ldmz           1/1     Running   <span class=m>0</span>             16m
</span></span></code></pre></td></tr></table></div></div><h3 id=运到问题解决办法>运到问题解决办法</h3><p>查看某个pod 一直失败的状态需要查看日志:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl logs --namespace kube-system calico-node-2kdks
</span></span></code></pre></td></tr></table></div></div><p>需要指定命令空间，最后才是pod 名称</p><p>通过查看日志就知道是哪里出错了，我一开始是因为Docker 切换运行时的问题卡了很久,然后就是一步步地查看日志去搜索解决的。</p><p>再如果是哪个pod一直卡住了，用<code>kubectl create -f ***.yaml</code>命令都删不掉需要执行手动强制删除pod命令：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl delete pod &lt;podname&gt; -n &lt;namespace&gt;
</span></span><span class=line><span class=cl>kubectl delete pod metrics-server-7b4c4d4bfd-c2b7c -n kube-system
</span></span></code></pre></td></tr></table></div></div><h3 id=最后安装kubernetesdashboard>最后安装kubernetes/dashboard</h3><p>直接打开官方GitHub 按照命令执行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml
</span></span></code></pre></td></tr></table></div></div><p>查看下是否完成了安装：
<img src=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_11.png width=1226 height=752 srcset="/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_11_huc643250ebb709029f18145cf13e5d35d_88374_480x0_resize_box_3.png 480w, /p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_11_huc643250ebb709029f18145cf13e5d35d_88374_1024x0_resize_box_3.png 1024w" loading=lazy alt=img_11.png class=gallery-image data-flex-grow=163 data-flex-basis=391px></p><p>然后再根据官方文档使用 Kubernetes 的服务帐户机制创建新用户，授予该用户管理员权限并使用与该用户绑定的不记名令牌登录仪表板</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vim admin-user.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: ServiceAccount
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: admin-user
</span></span><span class=line><span class=cl>  namespace: kubernetes-dashboard
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>vim cluster-admin.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class=line><span class=cl>kind: ClusterRoleBinding
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: admin-user
</span></span><span class=line><span class=cl>roleRef:
</span></span><span class=line><span class=cl>  apiGroup: rbac.authorization.k8s.io
</span></span><span class=line><span class=cl>  kind: ClusterRole
</span></span><span class=line><span class=cl>  name: cluster-admin
</span></span><span class=line><span class=cl>subjects:
</span></span><span class=line><span class=cl>- kind: ServiceAccount
</span></span><span class=line><span class=cl>  name: admin-user
</span></span><span class=line><span class=cl>  namespace: kubernetes-dashboard
</span></span></code></pre></td></tr></table></div></div><p>然后再自己新建一个service 资源把dashboard的资源端口暴露出来：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@panther-x2-main:~/dashboard# cat dashbord-service.yaml 
</span></span><span class=line><span class=cl>kind: Service
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  labels:
</span></span><span class=line><span class=cl>    k8s-app: kubernetes-dashboard
</span></span><span class=line><span class=cl>  name: kubernetes-dashboard
</span></span><span class=line><span class=cl>  namespace: kubernetes-dashboard
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>  type: NodePort
</span></span><span class=line><span class=cl>  ports:
</span></span><span class=line><span class=cl>    - port: <span class=m>443</span>
</span></span><span class=line><span class=cl>      targetPort: <span class=m>8443</span>
</span></span><span class=line><span class=cl>      nodePort: <span class=m>30002</span>
</span></span><span class=line><span class=cl>  selector:
</span></span><span class=line><span class=cl>    k8s-app: kubernetes-dashboard
</span></span></code></pre></td></tr></table></div></div><p>新建service资源：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl> kubectl apply -f dashbord-service.yaml 
</span></span></code></pre></td></tr></table></div></div><p>依次创建它们：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl apply -f admin-user.yaml
</span></span><span class=line><span class=cl>kubectl apply -f cluster-admin.yaml 
</span></span></code></pre></td></tr></table></div></div><p>获取不记名令牌:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl -n kubernetes-dashboard create token admin-user
</span></span></code></pre></td></tr></table></div></div><p>得到token:
<img src=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_12.png width=2315 height=307 srcset="/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_12_hu19b56fcdc3df88f1f7bf97adb8d8fe6f_69207_480x0_resize_box_3.png 480w, /p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_12_hu19b56fcdc3df88f1f7bf97adb8d8fe6f_69207_1024x0_resize_box_3.png 1024w" loading=lazy alt=img_12.png class=gallery-image data-flex-grow=754 data-flex-basis=1809px>
然后访问dashboard的内网地址和service 端口，填入刚生成的token记得要加<code>https</code>
<img src=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_13.png width=1340 height=866 srcset="/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_13_hu112c1304c285d9234d174ab18ef1e3dc_160163_480x0_resize_box_3.png 480w, /p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_13_hu112c1304c285d9234d174ab18ef1e3dc_160163_1024x0_resize_box_3.png 1024w" loading=lazy alt=img_13.png class=gallery-image data-flex-grow=154 data-flex-basis=371px>
进来了：
<img src=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_14.png width=2551 height=1486 srcset="/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_14_hu0ebc9f5a756f7d2d27519d20a8500f2a_207328_480x0_resize_box_3.png 480w, /p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_14_hu0ebc9f5a756f7d2d27519d20a8500f2a_207328_1024x0_resize_box_3.png 1024w" loading=lazy alt=img_14.png class=gallery-image data-flex-grow=171 data-flex-basis=412px>
可以在这里里面创建新的资源：
<img src=/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_15.png width=2560 height=1423 srcset="/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_15_huc9cbdb3d49b26f8a4bb1dfb08add1ec4_91216_480x0_resize_box_3.png 480w, /p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_15_huc9cbdb3d49b26f8a4bb1dfb08add1ec4_91216_1024x0_resize_box_3.png 1024w" loading=lazy alt=img_15.png class=gallery-image data-flex-grow=179 data-flex-basis=431px>
教程到此完结</p></section><footer class=article-footer><section class=article-tags><a href=/tags/kubernetes/>Kubernetes</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1chatgpt%E7%A7%81%E6%9C%89chatgpt%E7%BD%91%E9%A1%B5%E5%BA%94%E7%94%A8%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/><div class=article-image><img src=/p/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1chatgpt%E7%A7%81%E6%9C%89chatgpt%E7%BD%91%E9%A1%B5%E5%BA%94%E7%94%A8%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/title.24628614e6baa3c763e1945e2a323cf1_hu62cab933b2e5501d4229b78516907a97_121004_250x150_fill_q75_box_smart1.jpeg width=250 height=150 loading=lazy alt="Featured image of post 记录一次ChatGPT私有ChatGPT网页应用搭建教程" data-hash="md5-JGKGFOa6o8dj4ZReKjI88Q=="></div><div class=article-details><h2 class=article-title>记录一次ChatGPT私有ChatGPT网页应用搭建教程</h2></div></a></article><article class=has-image><a href=/p/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E5%AE%89%E8%A3%85%E5%BC%80%E6%BA%90%E4%BC%81%E4%B8%9A%E7%BA%A7%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86%E8%BD%AF%E4%BB%B6harbor/><div class=article-image><img src=/p/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E5%AE%89%E8%A3%85%E5%BC%80%E6%BA%90%E4%BC%81%E4%B8%9A%E7%BA%A7%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86%E8%BD%AF%E4%BB%B6harbor/title.47da209eb0a061d12e2a78b1c885d21d_hua6c10b1586b1f1d3be55f522340b661c_91215_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post 记录一次安装开源企业级镜像仓库管理软件：Harbor" data-hash="md5-R9ognrCgYdEuKnixyIXSHQ=="></div><div class=article-details><h2 class=article-title>记录一次安装开源企业级镜像仓库管理软件：Harbor</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=koala9527/my-hugo-blog issue-term=pathname crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>let utterancesLoaded=!1;function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;utterancesLoaded=!0,setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{if(!utterancesLoaded)return;setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2024 Example Site</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.27.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>