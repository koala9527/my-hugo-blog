<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Kubernetes on Example Site</title><link>https://blog.tuwei.space/tags/kubernetes/</link><description>Recent content in Kubernetes on Example Site</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Wed, 21 Jun 2023 11:09:58 +0800</lastBuildDate><atom:link href="https://blog.tuwei.space/tags/kubernetes/index.xml" rel="self" type="application/rss+xml"/><item><title>用ARM盒子 再次搭建一个最新版本的K8s集群</title><link>https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/</link><pubDate>Wed, 21 Jun 2023 11:09:58 +0800</pubDate><guid>https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/</guid><description>&lt;img src="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/1.27.png" alt="Featured image of post 用ARM盒子 再次搭建一个最新版本的K8s集群" />&lt;h2 id="前言">前言
&lt;/h2>&lt;p>两年前买了四台树莓派4B 组了一个K8s 集群，在知乎，掘金发了两篇搭建的教程，一直都有人收藏，网上的教程也很少，今年年初看到树莓派溢价非常多，几乎没有做什么应用搭建在上面，就拿过来组集群写些教程使用了，所以索性咸鱼几乎翻倍都出了。
最近看到随身wifi棒子特别的火，又有人搭建利用随身wifi的Docker Swarm集群，自己有想动手弄一个，又在咸鱼淘了四个处理器为RK3568的机器，处理器配置比树莓派配置要好，但是只有4G内存，主要是才90元一个，买了12V DC电源。不到400。
&lt;img src="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img.png"
width="3472"
height="3516"
srcset="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_hu15b83bf5d2d823155e26e27ae25ab1e4_13215049_480x0_resize_box_3.png 480w, https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_hu15b83bf5d2d823155e26e27ae25ab1e4_13215049_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="img.png"
class="gallery-image"
data-flex-grow="98"
data-flex-basis="236px"
>&lt;/p>
&lt;p>如果对kubernetes基本概念不熟悉，请务必找到之前文章去熟悉一下，之前的文章的细节描述非常仔细清楚~&lt;/p>
&lt;p>系统是自带的Armbian:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@panther-x2-main:~# uname -a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Linux panther-x2-main 6.1.28-rockchip64 &lt;span class="c1">#1 SMP PREEMPT Thu May 11 14:04:52 UTC 2023 aarch64 aarch64 aarch64 GNU/Linux&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Armbian是轻量级的Debian系统，Linux有两大分支系列，一个是Debian 一个是Redhat。每个系列又有不同的更细的分支。
Redhat是商业公司维护的发行版本，Debian是社区组织维护的发行版本
一般个人折腾用Debian 社区强大，公司的生产环境用Centos。&lt;/p>
&lt;p>&lt;img src="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_1.png"
width="952"
height="449"
srcset="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_1_hu53626e8b15ccdf75e1652654ccb860fd_24907_480x0_resize_box_3.png 480w, https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_1_hu53626e8b15ccdf75e1652654ccb860fd_24907_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="img_1.png"
class="gallery-image"
data-flex-grow="212"
data-flex-basis="508px"
>&lt;/p>
&lt;h2 id="开始">开始
&lt;/h2>&lt;h3 id="更改机器主机名称hostname">更改机器主机名称（hostname）
&lt;/h3>&lt;p>因为系统刷机后系统的名称完全一样，需要修改名称才能分辨他们&lt;/p>
&lt;p>一台Master节点 ，3台Work节点， 需要把四台机器的分为改为：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">panther-x2-main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">panther-x2-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">panther-x2-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">panther-x2-3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>每台机器设置分别需要修改&amp;quot;/etc/hostname&amp;quot;文件内容
用Master节点举一个例子：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">vim /etc/hostname
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>改完后的效果：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@panther-x2-main:~# cat /etc/hostname
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">panther-x2-main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@panther-x2-1:~# cat /etc/hostname
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">panther-x2-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@panther-x2-2:~# cat /etc/hostname
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">panther-x2-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@panther-x2-3:~# cat /etc/hostname
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">panther-x2-3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="设置静态ip">设置静态IP
&lt;/h3>&lt;p>静态IP的作用就是让机器在内网环境下有一个固定的IP，不能让它每次重启有一个不一样的IP，那样机器之间就无法正常沟通了。&lt;/p>
&lt;p>&lt;img src="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_2.png"
width="1882"
height="829"
srcset="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_2_hue4ba305397627b2d8139ddc94f49390e_93976_480x0_resize_box_3.png 480w, https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_2_hue4ba305397627b2d8139ddc94f49390e_93976_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="img_2.png"
class="gallery-image"
data-flex-grow="227"
data-flex-basis="544px"
>
每一台机器都需要执行一样的命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo cat &amp;gt;&amp;gt; /etc/hosts &lt;span class="s">&amp;lt;&amp;lt; EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">192.168.2.191 panther-x2-main
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">192.168.2.192 panther-x2-1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">192.168.2.193 panther-x2-2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">192.168.2.194 panther-x2-3
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="关闭swap-内存交换空间">关闭swap 内存交换空间
&lt;/h3>&lt;p>关闭它是为了保证Kubernetes集群的稳定性和可靠性，Swap分区是一种虚拟内存技术，当系统内存不足时，会将少用的内存数据交换到硬盘中，以便释放更多的内存空间给正在运行的进程使用。但是，当Swap分区被使用时，它会导致系统的性能下降，因为硬盘速度比内存慢得多。如果Kubernetes节点上的应用程序频繁地使用Swap分区，那么整个集群的性能就会受到影响，因此关闭Swap分区可以避免这种情况的发生&lt;/p>
&lt;p>每台机器都要执行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">vim /etc/default/armbian-zram-config
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_5.png"
width="522"
height="175"
srcset="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_5_hu84c1a17fb53b98945a9bd308465d92bc_10669_480x0_resize_box_3.png 480w, https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_5_hu84c1a17fb53b98945a9bd308465d92bc_10669_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="img_5.png"
class="gallery-image"
data-flex-grow="298"
data-flex-basis="715px"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">vim /etc/cron.d/armbian-truncate-logs
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>注释掉第三行&lt;/p>
&lt;p>&lt;img src="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_4.png"
width="507"
height="70"
srcset="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_4_huba29910d048b080eb63bdcfbd5e4863e_3618_480x0_resize_box_3.png 480w, https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_4_huba29910d048b080eb63bdcfbd5e4863e_3618_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="img_4.png"
class="gallery-image"
data-flex-grow="724"
data-flex-basis="1738px"
>&lt;/p>
&lt;p>然后注释掉最后一行：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">vim /etc/cron.daily/armbian-ram-logging
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_3.png"
width="487"
height="111"
srcset="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_3_hud96b3ec071a7b82bab1addd9577eb6d7_4555_480x0_resize_box_3.png 480w, https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_3_hud96b3ec071a7b82bab1addd9577eb6d7_4555_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="img_3.png"
class="gallery-image"
data-flex-grow="438"
data-flex-basis="1052px"
>&lt;/p>
&lt;p>然后重启，验证swap是否被关闭：&lt;/p>
&lt;p>&lt;img src="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_6.png"
width="971"
height="123"
srcset="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_6_hu2cbadfc9317087234066e39692b3f048_7718_480x0_resize_box_3.png 480w, https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_6_hu2cbadfc9317087234066e39692b3f048_7718_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="img_6.png"
class="gallery-image"
data-flex-grow="789"
data-flex-basis="1894px"
>&lt;/p>
&lt;h3 id="关闭selinux">关闭SElinux
&lt;/h3>&lt;p>根据提示没有安装&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@panther-x2-main:~# dpkg -s selinux-policy-default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dpkg-query: package &lt;span class="s1">&amp;#39;selinux-policy-default&amp;#39;&lt;/span> is not installed and no information is available
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Use dpkg --info &lt;span class="o">(=&lt;/span> dpkg-deb --info&lt;span class="o">)&lt;/span> to examine archive files.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="关闭ipv4转发">关闭IPv4转发
&lt;/h3>&lt;p>IPv4 转发通常允许将网络流量从一个网络接口传输到另一个网络接口可能会导致安全漏洞。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">/etc/sysctl.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>默认关闭了：&lt;/p>
&lt;p>&lt;img src="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_7.png"
width="499"
height="573"
srcset="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_7_hudb578ee901340abb3e9cdcd1c3a6f199_23762_480x0_resize_box_3.png 480w, https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_7_hudb578ee901340abb3e9cdcd1c3a6f199_23762_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="img_7.png"
class="gallery-image"
data-flex-grow="87"
data-flex-basis="209px"
>&lt;/p>
&lt;h3 id="安装一些软件">安装一些软件
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">apt-get update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt-get install apt-transport-https &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>ca-certificates &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>curl &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>gnupg2 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>software-properties-common
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo apt-get install docker-ce docker-ce-cli containerd.io
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="配置docker">配置docker
&lt;/h3>&lt;p>这个非常重要，Kubernetes官方指出在1.24之后删除了dockershim组件，我现在在要安装最新版的kubernetes1.27,默认的运行时是contained，而目前Docker 安装的默认运行时是docker-runc，所以需要切换Docker 的运行时。
偷了懒问了一下chatgpt 如何切换docker运行时，实测很准确&lt;/p>
&lt;p>&lt;img src="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_8.png"
width="1246"
height="776"
srcset="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_8_huef751047c201086cddd84af8e5993455_22763_480x0_resize_box_3.png 480w, https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_8_huef751047c201086cddd84af8e5993455_22763_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="img_8.png"
class="gallery-image"
data-flex-grow="160"
data-flex-basis="385px"
>&lt;/p>
&lt;p>最近因为某些原因Docker好多镜像拉取不下来，需要手动添加一下镜像源，需要如下修改：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@panther-x2-main:~# cat /etc/docker/daemon.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;exec-opts&amp;#34;&lt;/span>: &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;native.cgroupdriver=systemd&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;registry-mirrors&amp;#34;&lt;/span>: &lt;span class="o">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;https://docker.m.daocloud.io&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;https://dockerproxy.com&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;https://docker.mirrors.ustc.edu.cn&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;https://docker.nju.edu.cn&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">]&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;default-runtime&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;containerd&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;runtimes&amp;#34;&lt;/span>: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;containerd&amp;#34;&lt;/span>: &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;path&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;/usr/bin/containerd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>最后验证一下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@panther-x2-main:~# docker info &lt;span class="p">|&lt;/span> grep -i runtime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Runtimes: containerd io.containerd.runc.v2 runc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Default Runtime: containerd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@panther-x2-main:~#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="安装最新版kubeletkubeadmkubectl">安装最新版kubelet，kubeadm，kubectl
&lt;/h3>&lt;p>每个机器都有需要执行以下命令：
更新 apt 包索引并安装使用 Kubernetes apt 仓库所需要的包：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo apt-get update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get install -y apt-transport-https ca-certificates curl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>下载 Google Cloud 公开签名秘钥：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">curl -fsSL https://packages.cloud.google.com/apt/doc/apt-key.gpg &lt;span class="p">|&lt;/span> sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-archive-keyring.gpg
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>添加 Kubernetes apt 仓库：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;deb [signed-by=/etc/apt/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> sudo tee /etc/apt/sources.list.d/kubernetes.list
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装 kubelet、kubeadm 和 kubectl，之前使用树莓派安装的是1.20版本的，社区已经不支持和维护了，k8s版本迭代的还是很快的，目前是四个月一个小版本，一个月支持版本一个补丁，还是很快的，有很大的学习压力呀，还有关联到了各种的组件的支持
目前最新的版本是1.27，现在来根据官方文档安装：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo apt-get install -y kubelet kubeadm kubectl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-mark hold kubelet kubeadm kubectl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="前置设置">前置设置
&lt;/h3>&lt;p>根据文档/etc/containerd/config.toml 更改驱动&lt;br>
containerd config default &amp;gt; /etc/containerd/config.toml&lt;/p>
&lt;p>&lt;img src="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_10.png"
width="1016"
height="567"
srcset="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_10_hu3a0e544ebd55b83f9c948107e9a3cfac_40152_480x0_resize_box_3.png 480w, https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_10_hu3a0e544ebd55b83f9c948107e9a3cfac_40152_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="img_10.png"
class="gallery-image"
data-flex-grow="179"
data-flex-basis="430px"
>&lt;/p>
&lt;p>修改：/etc/containerd/config.toml&lt;/p>
&lt;p>将SystemdCgroup的值修改为true，将sandbox_image的值修改为国内镜像registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.8
&lt;img src="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_9.png"
width="1081"
height="804"
srcset="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_9_hued8834697a64558b236a99fbe9faa5e5_51294_480x0_resize_box_3.png 480w, https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_9_hued8834697a64558b236a99fbe9faa5e5_51294_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="img_9.png"
class="gallery-image"
data-flex-grow="134"
data-flex-basis="322px"
>&lt;/p>
&lt;p>然后重启contained:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">systemctl restart containerd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>还可以做一下前置检查&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubeadm init phase preflight
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="前置拉取镜像改名字">前置拉取镜像改名字：
&lt;/h3>&lt;p>由于某些原因直接拉去k8s所需要的镜像是拉取不下来的，只能参照官方的离线安装方案，先把同步到国内源的镜像拉取下来再改tag名称，最好做一个shell脚本，每台机器都需要执行一下拉取镜像，改tag名称：
脚本内容：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@panther-x2-main:~# cat pull_k8s_docker.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">MY_REGISTRY&lt;/span>&lt;span class="o">=&lt;/span>registry.aliyuncs.com/google_containers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">K8S_VERSION&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;v1.27.2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;==========================================================&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;Pull Kubernetes for x64 v&lt;/span>&lt;span class="nv">$K8S_VERSION&lt;/span>&lt;span class="s2"> Images from docker.io ......&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;==========================================================&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 拉取镜像%s/oldWords/newWords//g&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker pull &lt;span class="si">${&lt;/span>&lt;span class="nv">MY_REGISTRY&lt;/span>&lt;span class="si">}&lt;/span>/kube-apiserver:&lt;span class="nv">$K8S_VERSION&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker pull &lt;span class="si">${&lt;/span>&lt;span class="nv">MY_REGISTRY&lt;/span>&lt;span class="si">}&lt;/span>/kube-controller-manager:&lt;span class="nv">$K8S_VERSION&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker pull &lt;span class="si">${&lt;/span>&lt;span class="nv">MY_REGISTRY&lt;/span>&lt;span class="si">}&lt;/span>/kube-scheduler:&lt;span class="nv">$K8S_VERSION&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker pull &lt;span class="si">${&lt;/span>&lt;span class="nv">MY_REGISTRY&lt;/span>&lt;span class="si">}&lt;/span>/kube-proxy:&lt;span class="nv">$K8S_VERSION&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker pull &lt;span class="si">${&lt;/span>&lt;span class="nv">MY_REGISTRY&lt;/span>&lt;span class="si">}&lt;/span>/pause:3.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker pull &lt;span class="si">${&lt;/span>&lt;span class="nv">MY_REGISTRY&lt;/span>&lt;span class="si">}&lt;/span>/etcd:3.5.7-0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker pull coredns/coredns:1.10.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 添加Tag&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker tag &lt;span class="si">${&lt;/span>&lt;span class="nv">MY_REGISTRY&lt;/span>&lt;span class="si">}&lt;/span>/kube-apiserver:&lt;span class="nv">$K8S_VERSION&lt;/span> registry.k8s.io/kube-apiserver:&lt;span class="nv">$K8S_VERSION&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker tag &lt;span class="si">${&lt;/span>&lt;span class="nv">MY_REGISTRY&lt;/span>&lt;span class="si">}&lt;/span>/kube-scheduler:&lt;span class="nv">$K8S_VERSION&lt;/span> registry.k8s.io/kube-scheduler:&lt;span class="nv">$K8S_VERSION&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker tag &lt;span class="si">${&lt;/span>&lt;span class="nv">MY_REGISTRY&lt;/span>&lt;span class="si">}&lt;/span>/kube-controller-manager:&lt;span class="nv">$K8S_VERSION&lt;/span> registry.k8s.io/kube-controller-manager:&lt;span class="nv">$K8S_VERSION&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker tag &lt;span class="si">${&lt;/span>&lt;span class="nv">MY_REGISTRY&lt;/span>&lt;span class="si">}&lt;/span>/kube-proxy:&lt;span class="nv">$K8S_VERSION&lt;/span> registry.k8s.io/kube-proxy:&lt;span class="nv">$K8S_VERSION&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker tag &lt;span class="si">${&lt;/span>&lt;span class="nv">MY_REGISTRY&lt;/span>&lt;span class="si">}&lt;/span>/pause:3.8 registry.k8s.io/pause:3.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker tag &lt;span class="si">${&lt;/span>&lt;span class="nv">MY_REGISTRY&lt;/span>&lt;span class="si">}&lt;/span>/etcd:3.5.7-0 registry.k8s.io/etcd:3.5.7-0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker tag coredns/coredns:1.10.1 registry.k8s.io/coredns:v1.10.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="开始安装">开始安装
&lt;/h3>&lt;p>在Master 节点执行一下命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo kubeadm init --image-repository&lt;span class="o">=&lt;/span>registry.aliyuncs.com/google_containers --kubernetes-version&lt;span class="o">=&lt;/span>v1.27.2 --apiserver-advertise-address&lt;span class="o">=&lt;/span>192.168.2.191 --pod-network-cidr&lt;span class="o">=&lt;/span>192.168.0.0/16 --ignore-preflight-errors&lt;span class="o">=&lt;/span>all
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>效果如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@panther-x2-main:~# sudo kubeadm init --image-repository&lt;span class="o">=&lt;/span>registry.aliyuncs.com/google_containers --kubernetes-version&lt;span class="o">=&lt;/span>v1.27.2 --apiserver-advertise-address&lt;span class="o">=&lt;/span>192.168.2.191 --pod-network-cidr&lt;span class="o">=&lt;/span>192.168.0.0/16 --ignore-preflight-errors&lt;span class="o">=&lt;/span>all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>init&lt;span class="o">]&lt;/span> Using Kubernetes version: v1.27.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> Running pre-flight checks
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> Pulling images required &lt;span class="k">for&lt;/span> setting up a Kubernetes cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> This might take a minute or two, depending on the speed of your internet connection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>preflight&lt;span class="o">]&lt;/span> You can also perform this action in beforehand using &lt;span class="s1">&amp;#39;kubeadm config images pull&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">W0611 22:16:04.216900 &lt;span class="m">4263&lt;/span> images.go:80&lt;span class="o">]&lt;/span> could not find officially supported version of etcd &lt;span class="k">for&lt;/span> Kubernetes v1.27.2, falling back to the nearest etcd version &lt;span class="o">(&lt;/span>3.5.7-0&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">W0611 22:16:04.743772 &lt;span class="m">4263&lt;/span> checks.go:835&lt;span class="o">]&lt;/span> detected that the sandbox image &lt;span class="s2">&amp;#34;registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.8&amp;#34;&lt;/span> of the container runtime is inconsistent with that used by kubeadm. It is recommended that using &lt;span class="s2">&amp;#34;registry.aliyuncs.com/google_containers/pause:3.9&amp;#34;&lt;/span> as the CRI sandbox image.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Using certificateDir folder &lt;span class="s2">&amp;#34;/etc/kubernetes/pki&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;ca&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;apiserver&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> apiserver serving cert is signed &lt;span class="k">for&lt;/span> DNS names &lt;span class="o">[&lt;/span>kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local panther-x2-main&lt;span class="o">]&lt;/span> and IPs &lt;span class="o">[&lt;/span>10.96.0.1 192.168.2.191&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;apiserver-kubelet-client&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;front-proxy-ca&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;front-proxy-client&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/ca&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/server&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> etcd/server serving cert is signed &lt;span class="k">for&lt;/span> DNS names &lt;span class="o">[&lt;/span>localhost panther-x2-main&lt;span class="o">]&lt;/span> and IPs &lt;span class="o">[&lt;/span>192.168.2.191 127.0.0.1 ::1&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/peer&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> etcd/peer serving cert is signed &lt;span class="k">for&lt;/span> DNS names &lt;span class="o">[&lt;/span>localhost panther-x2-main&lt;span class="o">]&lt;/span> and IPs &lt;span class="o">[&lt;/span>192.168.2.191 127.0.0.1 ::1&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;etcd/healthcheck-client&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;apiserver-etcd-client&amp;#34;&lt;/span> certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>certs&lt;span class="o">]&lt;/span> Generating &lt;span class="s2">&amp;#34;sa&amp;#34;&lt;/span> key and public key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Using kubeconfig folder &lt;span class="s2">&amp;#34;/etc/kubernetes&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;admin.conf&amp;#34;&lt;/span> kubeconfig file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;kubelet.conf&amp;#34;&lt;/span> kubeconfig file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;controller-manager.conf&amp;#34;&lt;/span> kubeconfig file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubeconfig&lt;span class="o">]&lt;/span> Writing &lt;span class="s2">&amp;#34;scheduler.conf&amp;#34;&lt;/span> kubeconfig file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Writing kubelet environment file with flags to file &lt;span class="s2">&amp;#34;/var/lib/kubelet/kubeadm-flags.env&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Writing kubelet configuration to file &lt;span class="s2">&amp;#34;/var/lib/kubelet/config.yaml&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-start&lt;span class="o">]&lt;/span> Starting the kubelet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Using manifest folder &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="s2">&amp;#34;kube-apiserver&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="s2">&amp;#34;kube-controller-manager&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>control-plane&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="s2">&amp;#34;kube-scheduler&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>etcd&lt;span class="o">]&lt;/span> Creating static Pod manifest &lt;span class="k">for&lt;/span> &lt;span class="nb">local&lt;/span> etcd in &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">W0611 22:16:26.878081 &lt;span class="m">4263&lt;/span> images.go:80&lt;span class="o">]&lt;/span> could not find officially supported version of etcd &lt;span class="k">for&lt;/span> Kubernetes v1.27.2, falling back to the nearest etcd version &lt;span class="o">(&lt;/span>3.5.7-0&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>wait-control-plane&lt;span class="o">]&lt;/span> Waiting &lt;span class="k">for&lt;/span> the kubelet to boot up the control plane as static Pods from directory &lt;span class="s2">&amp;#34;/etc/kubernetes/manifests&amp;#34;&lt;/span>. This can take up to 4m0s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>apiclient&lt;span class="o">]&lt;/span> All control plane components are healthy after 21.008446 seconds
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>upload-config&lt;span class="o">]&lt;/span> Storing the configuration used in ConfigMap &lt;span class="s2">&amp;#34;kubeadm-config&amp;#34;&lt;/span> in the &lt;span class="s2">&amp;#34;kube-system&amp;#34;&lt;/span> Namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet&lt;span class="o">]&lt;/span> Creating a ConfigMap &lt;span class="s2">&amp;#34;kubelet-config&amp;#34;&lt;/span> in namespace kube-system with the configuration &lt;span class="k">for&lt;/span> the kubelets in the cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>upload-certs&lt;span class="o">]&lt;/span> Skipping phase. Please see --upload-certs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>mark-control-plane&lt;span class="o">]&lt;/span> Marking the node panther-x2-main as control-plane by adding the labels: &lt;span class="o">[&lt;/span>node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>mark-control-plane&lt;span class="o">]&lt;/span> Marking the node panther-x2-main as control-plane by adding the taints &lt;span class="o">[&lt;/span>node-role.kubernetes.io/control-plane:NoSchedule&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Using token: fnxxr7.lgu8fvkl1rc0gukc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configured RBAC rules to allow Node Bootstrap tokens to get nodes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order &lt;span class="k">for&lt;/span> nodes to get long term certificate credentials
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Configured RBAC rules to allow certificate rotation &lt;span class="k">for&lt;/span> all node client certificates in the cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>bootstrap-token&lt;span class="o">]&lt;/span> Creating the &lt;span class="s2">&amp;#34;cluster-info&amp;#34;&lt;/span> ConfigMap in the &lt;span class="s2">&amp;#34;kube-public&amp;#34;&lt;/span> namespace
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>kubelet-finalize&lt;span class="o">]&lt;/span> Updating &lt;span class="s2">&amp;#34;/etc/kubernetes/kubelet.conf&amp;#34;&lt;/span> to point to a rotatable kubelet client certificate and key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>addons&lt;span class="o">]&lt;/span> Applied essential addon: CoreDNS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>addons&lt;span class="o">]&lt;/span> Applied essential addon: kube-proxy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your Kubernetes control-plane has initialized successfully!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To start using your cluster, you need to run the following as a regular user:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mkdir -p &lt;span class="nv">$HOME&lt;/span>/.kube
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo cp -i /etc/kubernetes/admin.conf &lt;span class="nv">$HOME&lt;/span>/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo chown &lt;span class="k">$(&lt;/span>id -u&lt;span class="k">)&lt;/span>:&lt;span class="k">$(&lt;/span>id -g&lt;span class="k">)&lt;/span> &lt;span class="nv">$HOME&lt;/span>/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Alternatively, &lt;span class="k">if&lt;/span> you are the root user, you can run:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">export&lt;/span> &lt;span class="nv">KUBECONFIG&lt;/span>&lt;span class="o">=&lt;/span>/etc/kubernetes/admin.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You should now deploy a pod network to the cluster.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Run &lt;span class="s2">&amp;#34;kubectl apply -f [podnetwork].yaml&amp;#34;&lt;/span> with one of the options listed at:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> https://kubernetes.io/docs/concepts/cluster-administration/addons/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Then you can join any number of worker nodes by running the following on each as root:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubeadm join 192.168.2.191:6443 --token fnxxr7.lgu8fvkl1******* &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --discovery-token-ca-cert-hash sha256:17a1ad0ad3da3cd3d558c7ba9029cd0043c5a4fa53c2*********************
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装成功。已经提示需要再在Work节点使用 &lt;code>kubeadm join&lt;/code> 就行了&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubeadm join 192.168.2.191:6443 --token fnxxr7.lgu8fvkl1******* &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --discovery-token-ca-cert-hash sha256:17a1ad0ad3da3cd3d558c7ba9029cd0043c5a4fa53c2*********************
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="安装pod-网络附加组件">安装Pod 网络附加组件
&lt;/h3>&lt;p>查看node 状态执行之前需要根据上面的提示让当前用户有管理k8s的权限：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> mkdir -p &lt;span class="nv">$HOME&lt;/span>/.kube
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo cp -i /etc/kubernetes/admin.conf &lt;span class="nv">$HOME&lt;/span>/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sudo chown &lt;span class="k">$(&lt;/span>id -u&lt;span class="k">)&lt;/span>:&lt;span class="k">$(&lt;/span>id -g&lt;span class="k">)&lt;/span> &lt;span class="nv">$HOME&lt;/span>/.kube/config
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后使用&lt;code>kubectl get nodes&lt;/code> 查看每个node的状态，目前是notready的状态，需要安装网络覆盖组件&lt;/p>
&lt;p>首先，在您的集群上安装 Operator&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl create -f https://raw.githubusercontent.com/projectcalico/calico/v3.26.0/manifests/tigera-operator.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>下载配置 Calico 所需的自定义资源&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">curl https://raw.githubusercontent.com/projectcalico/calico/v3.26.0/manifests/custom-resources.yaml -O
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>创建清单以安装 Calico&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl create -f custom-resources.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>稍等一会查看所有pod状态&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@panther-x2-main:~# kubectl get pod -A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-apiserver calico-apiserver-76fd8c9559-nfd8b 1/1 Running &lt;span class="m">0&lt;/span> 3m6s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-apiserver calico-apiserver-76fd8c9559-zbwrq 1/1 Running &lt;span class="m">0&lt;/span> 3m6s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-system calico-kube-controllers-6bcdfc4b44-mlp8w 1/1 Running &lt;span class="m">0&lt;/span> 15m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-system calico-node-7gv5s 1/1 Running &lt;span class="m">0&lt;/span> 15m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-system calico-node-ck8vf 1/1 Running &lt;span class="m">0&lt;/span> 15m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-system calico-node-scd9k 1/1 Running &lt;span class="m">0&lt;/span> 15m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-system calico-node-vzwr9 1/1 Running &lt;span class="m">0&lt;/span> 15m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-system calico-typha-5fd468897-gw7gd 1/1 Running &lt;span class="m">0&lt;/span> 15m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-system calico-typha-5fd468897-n2qkq 1/1 Running &lt;span class="m">0&lt;/span> 15m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-system csi-node-driver-9ph8d 2/2 Running &lt;span class="m">0&lt;/span> 15m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-system csi-node-driver-kj26d 2/2 Running &lt;span class="m">0&lt;/span> 15m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-system csi-node-driver-m6945 2/2 Running &lt;span class="m">0&lt;/span> 15m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">calico-system csi-node-driver-sjxps 2/2 Running &lt;span class="m">0&lt;/span> 15m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system coredns-7bdc4cb885-5krtc 1/1 Running &lt;span class="m">7&lt;/span> &lt;span class="o">(&lt;/span>99m ago&lt;span class="o">)&lt;/span> 47h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system coredns-7bdc4cb885-pbxc4 1/1 Running &lt;span class="m">7&lt;/span> &lt;span class="o">(&lt;/span>99m ago&lt;span class="o">)&lt;/span> 47h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system etcd-panther-x2-main 1/1 Running &lt;span class="m">9&lt;/span> &lt;span class="o">(&lt;/span>99m ago&lt;span class="o">)&lt;/span> 47h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system kube-apiserver-panther-x2-main 1/1 Running &lt;span class="m">9&lt;/span> &lt;span class="o">(&lt;/span>99m ago&lt;span class="o">)&lt;/span> 47h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system kube-controller-manager-panther-x2-main 1/1 Running &lt;span class="m">6&lt;/span> &lt;span class="o">(&lt;/span>99m ago&lt;span class="o">)&lt;/span> 10h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system kube-proxy-8jgfs 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>99m ago&lt;span class="o">)&lt;/span> 47h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system kube-proxy-9g4vg 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>99m ago&lt;span class="o">)&lt;/span> 47h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system kube-proxy-qc84s 1/1 Running &lt;span class="m">5&lt;/span> &lt;span class="o">(&lt;/span>99m ago&lt;span class="o">)&lt;/span> 47h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system kube-proxy-zwbqm 1/1 Running &lt;span class="m">9&lt;/span> &lt;span class="o">(&lt;/span>99m ago&lt;span class="o">)&lt;/span> 47h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kube-system kube-scheduler-panther-x2-main 1/1 Running &lt;span class="m">9&lt;/span> &lt;span class="o">(&lt;/span>99m ago&lt;span class="o">)&lt;/span> 47h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tigera-operator tigera-operator-58f95869d6-9ldmz 1/1 Running &lt;span class="m">0&lt;/span> 16m
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="运到问题解决办法">运到问题解决办法
&lt;/h3>&lt;p>查看某个pod 一直失败的状态需要查看日志:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl logs --namespace kube-system calico-node-2kdks
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>需要指定命令空间，最后才是pod 名称&lt;/p>
&lt;p>通过查看日志就知道是哪里出错了，我一开始是因为Docker 切换运行时的问题卡了很久,然后就是一步步地查看日志去搜索解决的。&lt;/p>
&lt;p>再如果是哪个pod一直卡住了，用&lt;code>kubectl create -f ***.yaml&lt;/code>命令都删不掉需要执行手动强制删除pod命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl delete pod &amp;lt;podname&amp;gt; -n &amp;lt;namespace&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl delete pod metrics-server-7b4c4d4bfd-c2b7c -n kube-system
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="最后安装kubernetesdashboard">最后安装kubernetes/dashboard
&lt;/h3>&lt;p>直接打开官方GitHub 按照命令执行：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看下是否完成了安装：
&lt;img src="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_11.png"
width="1226"
height="752"
srcset="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_11_huc643250ebb709029f18145cf13e5d35d_88374_480x0_resize_box_3.png 480w, https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_11_huc643250ebb709029f18145cf13e5d35d_88374_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="img_11.png"
class="gallery-image"
data-flex-grow="163"
data-flex-basis="391px"
>&lt;/p>
&lt;p>然后再根据官方文档使用 Kubernetes 的服务帐户机制创建新用户，授予该用户管理员权限并使用与该用户绑定的不记名令牌登录仪表板&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">vim admin-user.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: ServiceAccount
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: admin-user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: kubernetes-dashboard
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">vim cluster-admin.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: rbac.authorization.k8s.io/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: ClusterRoleBinding
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: admin-user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">roleRef:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apiGroup: rbac.authorization.k8s.io
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> kind: ClusterRole
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: cluster-admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">subjects:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- kind: ServiceAccount
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: admin-user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: kubernetes-dashboard
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后再自己新建一个service 资源把dashboard的资源端口暴露出来：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@panther-x2-main:~/dashboard# cat dashbord-service.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: Service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> k8s-app: kubernetes-dashboard
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: kubernetes-dashboard
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: kubernetes-dashboard
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type: NodePort
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ports:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - port: &lt;span class="m">443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> targetPort: &lt;span class="m">8443&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nodePort: &lt;span class="m">30002&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> selector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> k8s-app: kubernetes-dashboard
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>新建service资源：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> kubectl apply -f dashbord-service.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>依次创建它们：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl apply -f admin-user.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl apply -f cluster-admin.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>获取不记名令牌:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kubectl -n kubernetes-dashboard create token admin-user
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>得到token:
&lt;img src="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_12.png"
width="2315"
height="307"
srcset="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_12_hu19b56fcdc3df88f1f7bf97adb8d8fe6f_69207_480x0_resize_box_3.png 480w, https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_12_hu19b56fcdc3df88f1f7bf97adb8d8fe6f_69207_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="img_12.png"
class="gallery-image"
data-flex-grow="754"
data-flex-basis="1809px"
>
然后访问dashboard的内网地址和service 端口，填入刚生成的token记得要加&lt;code>https&lt;/code>
&lt;img src="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_13.png"
width="1340"
height="866"
srcset="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_13_hu112c1304c285d9234d174ab18ef1e3dc_160163_480x0_resize_box_3.png 480w, https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_13_hu112c1304c285d9234d174ab18ef1e3dc_160163_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="img_13.png"
class="gallery-image"
data-flex-grow="154"
data-flex-basis="371px"
>
进来了：
&lt;img src="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_14.png"
width="2551"
height="1486"
srcset="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_14_hu0ebc9f5a756f7d2d27519d20a8500f2a_207328_480x0_resize_box_3.png 480w, https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_14_hu0ebc9f5a756f7d2d27519d20a8500f2a_207328_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="img_14.png"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="412px"
>
可以在这里里面创建新的资源：
&lt;img src="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_15.png"
width="2560"
height="1423"
srcset="https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_15_huc9cbdb3d49b26f8a4bb1dfb08add1ec4_91216_480x0_resize_box_3.png 480w, https://blog.tuwei.space/p/%E7%94%A8arm%E7%9B%92%E5%AD%90-%E5%86%8D%E6%AC%A1%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84k8s%E9%9B%86%E7%BE%A4/img_15_huc9cbdb3d49b26f8a4bb1dfb08add1ec4_91216_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="img_15.png"
class="gallery-image"
data-flex-grow="179"
data-flex-basis="431px"
>
教程到此完结&lt;/p></description></item></channel></rss>